# 유니티에서 데이터 저장하기



## PlayerPrefs



## CSV



## JSON

json은 웹이나 네트워크에서 서버와 클라이언트 사이에서 데이터를 주고받을때 사용하는 개방형 표준 포멧으로, 텍스트를 사용하기 때문에 사람이 이해하기 쉽다는 장점이 있다. JSON은 사용범위가 거의 일치하는 XML에 비해 가독성이 좋고 직렬화와 비직렬화 함수를 통해 데이터와 JSON 데이터를 편하게 변환할 수 있다는 장점을 가지고 있다.

유니티에서는 JsonUtility 클래스를 사용해 오브젝트를 JSON포맷으로 상호 작용할 수 있다. 

직렬화 : 데이터 구조나 오브젝트 상태를 동일하거나 다른 컴퓨터 환경에 저장하고 나중에 재구성할 수 있는 포맷으로 변환하는 과정이다.

### 기본 구조

키와 값의 쌍으로 이루어진 데이터를 저장한다. 기본 자료형은 수(정수, 실수), 문자열, boolean, 배열, 객체, null을 지원한다. `{ }`는 객체를 의미하고, `[ ]`는 순서가 있는 배열을 나타낸다. 

```json
 {
    "이름": "홍길동",
    "나이": 25,
    "성별": "여",
    "주소": "서울특별시 양천구 목동",
    "특기": ["농구", "도술"],
    "가족관계": {"#": 2, "아버지": "홍판서", "어머니": "춘섬"},
    "회사": "경기 수원시 팔달구 우만동"
 }
```

### 장점

- 텍스트로 이루어져 사람과 기계 모두 읽고 쓰기 쉽다.
- 프로그래밍 언어와 플랫폼에 독립적이므로 서로 다른 시스템간에 객체를 교환하기에 좋다.



### 정적 함수

| [FromJson](https://docs.unity3d.com/kr/2019.4/ScriptReference/JsonUtility.FromJson.html) | Create an object from its JSON representation.               |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| [FromJsonOverwrite](https://docs.unity3d.com/kr/2019.4/ScriptReference/JsonUtility.FromJsonOverwrite.html) | Overwrite data in an object by reading from its JSON representation. |
| [ToJson](https://docs.unity3d.com/kr/2019.4/ScriptReference/JsonUtility.ToJson.html) | Generate a JSON representation of the public fields of an object |

### 예제

JSON 직렬화는 구조화된 JSON을 사용한다.  JSON 데이터에 저장하려는 변수를 설명하는 클래스 또는 구조를 만든다. 변수들이 있는 클래스를 정의하고 `[Serializable]` 속성으로 표시해 JSON 시리얼라이저와 연동되도록 한다.

```c#
[Serializable]
public class MyClass
{
    public int level;
    public float timeElapsed;
    public string playerName;
}
```

그 다음, 클래스의 인스턴스를 만들고

```c#
MyClass myObject = new MyClass();
myObject.level = 18;
myObject.timeElapsed = 1.12f;
myObject.playerName = "World Star Jungmin";
```

` JsonUtility.ToJson` 메서드를 사용해 JSON 포맷으로 전환한다.

JSON을 다시 오브젝트로 전환하려면 `JsonUtility.FromJson` 메서드를 사용한다.

```c#
string json = JsonUtility.ToJson(myObject);
/* json now contains: 
'{
    "level":18,
    "timeElapsed":1.12f,
    "playerName":"World Star Jungmin"
}'*/
myObject = JsonUtility.FromJson<MyClass>(json);  // 대충 json을 MyClass 형식의 인스턴스로 전환한다는 뜻
```

\* 새 인스턴스가 생성되고 JSON 데이터를 사용해 인스턴스의 값이 설정된다.  JSON 데이터에 클래스에 없는 값이 있으면 해당 값은 무시되며, 클래스에 있는 값이 누락되면 구성된 값을 오브젝트에 그대로 유지한다.

기존에 있던 오브젝트에 JSON데이터를 역직렬화해 기존 데이터를 덮어쓸 수 있다.

JSON데이터에 필드에 대한 값이 없으면 시리얼라이저는 해당 필드의 값을 변경하지 않는다. 이를 통해 일부만 작성된 JSON으로 오브젝트를 덮어써 `패치`를 할 수 있다 

```c#
JsonUtility.FromJsonOverwrite(json, myObject);
```



### 데이터 파일로 저장하고 불러오기

- 파일 저장 예제

```c#
void CreateJsonFile(string createPath, string fileName, string jsonData)
{
    FileStream fileStream = new FileStream(string.Format("{0}/{1}", createPath, fileName), FileMode.Create);  // 생성자 FileStream(String, FileMode)
    byte[] data = Encoding.UTF8.GetBytes(jsonData);
    fileStream.Write(data, 0, data.Length);  // byte로 인코딩 한 것을 파일스트림에 작성
    fileStream.Close();
}

...void start()
MyClass obj = new MyClass(true);
string data = JsonUtility.ToJson(obj);
CreateJsonFile(Application.dataPath, "MyClass", jsonData);  // 윈도우-프로젝트디렉토리/Assets
```

[FileStream 생성자](https://docs.microsoft.com/ko-kr/dotnet/api/system.io.filestream.-ctor?view=net-5.0)

[Unity Application.dataPath](https://3dmpengines.tistory.com/1745)



- 파일 불러오기 예제

```c#
T LoadJsonFile<T>(string loadPath, string fileName)
{
	FileStream fileStream = new FileStream(string.Format("{0}/{1}.Jason", loadPath, fileName),FileMode.Open);
	byte[] data = new byte[fileStream.Length];
	fileStream.Read(data,0,data.Length);
	fileStream.Close();
    
	string jsonData = Encoding.UTF8.GetString(data);
	return JsonUtility.FromJson<T>(jsonData);
}

...void start()
var jtc2 = LoadJsonFile<JTestClass>(Application.dataPath, "JTestClass");
```









참고

https://wergia.tistory.com/164

https://ko.wikipedia.org/wiki/JSON

https://docs.unity3d.com/kr/2019.4/Manual/JSONSerialization.html

[https://ko.wikipedia.org/wiki/직렬화](https://ko.wikipedia.org/wiki/%EC%A7%81%EB%A0%AC%ED%99%94)